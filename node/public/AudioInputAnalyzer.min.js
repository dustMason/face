/*! AudioInputAnalyzer v1.0.0 - 2013-09-11 03:09:22 
Vince Allen |Brooklyn, NY | vince@vinceallen.com | @vinceallenvince | License: MIT */
!function(a,b){function c(){this.context=null,this.analyser=null,this.freqDomain=null,this.timeDomain=null}b.AudioInputAnalyzer=a,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.AudioContextClass=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var d=[31,63,125,250,500,1e3,2e3,4e3,8e3,16e3],e=[20,25,31,40,50,63,80,100,126,160,201,253,320,403,507,640,806,1e3,1300,1600,2e3,2500,3200,4e3,5100,6400,8100,1e4,13e3,16e3,2e4];c.prototype.map=function(a,b,c,d,e){var f=(a-b)/(c-b);return f*(e-d)+d},c.prototype.init=function(){if(!this.hasWebAudio())throw new Error("Web Audio API is not supported in your browser.");if(this.context=new window.AudioContextClass,!this.hasGetUserMedia())throw new Error("getUserMedia() is not supported in your browser.");navigator.getMedia({audio:!0},this.handleUserMedia.bind(this),this.failUserMedia)},c.prototype.handleUserMedia=function(a){this.microphone=this.context.createMediaStreamSource(a),this.meter=this.context.createJavaScriptNode(2048,2,2),this.meter.onaudioprocess=this.processAudio.bind(this),this.meter.connect(this.context.destination),this.analyser1=this.context.createAnalyser(),this.analyser1.smoothingTimeConstant=.3,this.analyser1.fftSize=512,this.analyser2=this.context.createAnalyser(),this.analyser2.smoothingTimeConstant=.3,this.analyser2.fftSize=512,this.splitter=this.context.createChannelSplitter(2),this.microphone.connect(this.splitter),this.splitter.connect(this.analyser1,0,0),this.splitter.connect(this.analyser2,1,0),this.analyser1.connect(this.meter)},c.prototype.processAudio=function(b){var c,f,g,h,i=b.inputBuffer.getChannelData(0),j=b.inputBuffer.getChannelData(1),k=new Uint8Array(this.analyser1.frequencyBinCount),l=new Uint8Array(this.analyser2.frequencyBinCount),m=new Uint8Array(this.analyser1.frequencyBinCount),n=new Uint8Array(this.analyser2.frequencyBinCount),o=[],p=[],q=[],r=[];c=this.getArrayAbsoluteAverage(i),f=this.getArrayAbsoluteAverage(j),this.analyser1.getByteFrequencyData(k),g=this.getArrayAverage(k),this.analyser2.getByteFrequencyData(l),h=this.getArrayAverage(l),this.analyser1.getByteTimeDomainData(m),this.analyser2.getByteTimeDomainData(n),o=this.createBandArray(d,k),q=this.createBandArray(e,k),p=this.createBandArray(d,l),r=this.createBandArray(e,l),a.PubSub.publish("meter",{channelLevel1:c,channelLevel2:f,averageVol1:g,averageVol2:h,freqDomain1:k,freqDomain2:l,timeDomain1:m,timeDomain2:n,BAND10Array1:o,BAND10Array2:p,BAND31Array1:q,BAND31Array2:r})},c.prototype.createBandArray=function(a,b){var c,d=[];for(c=0;c<a.length;c++)d.push(this.getFrequencyValue(a[c],b));return d},c.prototype.getArrayAverage=function(a){var b,c,d=0;for(b=0,c=a.length;c>b;b++)d+=a[b];return d/c},c.prototype.getArrayAbsoluteAverage=function(a){var b,c,d=0;for(b=0,c=a.length;c>b;b++)d+=Math.abs(a[b]);return d/c},c.prototype.failUserMedia=function(a){document.body.textContent="Failed to get user media. "+a.name},c.prototype.getFrequencyValue=function(a,b){var c=this.context.sampleRate/2,d=Math.round(a/c*b.length);return b[d]},c.prototype.hasWebAudio=function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext)},c.prototype.hasGetUserMedia=function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},c.prototype.getViewportSize=function(){var a={width:void 0,height:void 0};return"undefined"!=typeof window.innerWidth?(a.width=window.innerWidth,a.height=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth?(a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight):"undefined"!=typeof document.body&&(a.width=document.body.clientWidth,a.height=document.body.clientHeight),a};var f={};f.subscribe=function(a,b){return this._callbacks||(this._callbacks={}),(this._callbacks[a]||(this._callbacks[a]=[])).push(b),this},f.publish=function(){var a,b,c,d,e=Array.prototype.slice.call(arguments,0),f=e.shift();if(!(b=this._callbacks))return this;if(!(a=this._callbacks[f]))return this;for(c=0,d=a.length;d>c;c+=1)a[c].apply(this,e);return this},a.BAND10=d,a.BAND31=e,a.AudioController=c,a.PubSub=f}({},function(){return this}());